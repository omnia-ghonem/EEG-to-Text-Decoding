{% extends "base.html" %}
{% block content %}
<style>
    .rectangle {
        background: #1c1c1c;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
    }
    .audio-container {
        background: #2a2a2a;
        border-radius: 5px;
        padding: 10px;
        margin-top: 10px;
    }
    .voice-button {
        background: none;
        border: none;
        cursor: pointer;
        padding: 10px;
    }
    .voice-button img {
        width: 24px;
        height: 24px;
    }
    audio {
        width: 100%;
        margin-top: 10px;
    }
    .hidden {
        display: none;
    }
</style>

<section>
    <div class="login-box">
        <!-- Logo Section -->
        <div class="logo">
            <img src="static/icons/ejust_logo.png" alt="Ludiflex Logo" class="logo-img">
        </div>
        <div class="login-header">
            <header>Results</header>
        </div>
        
        <!-- BART Prediction Section -->
        <div class="rectangle">
            <h3>BART Prediction</h3>
            <p>{{ bart_prediction }}</p>
            <div id="bart-button-container" {% if bart_audio_file %}class="hidden"{% endif %}>
                <form action="/speak" method="get" class="voice-form">
                    <input type="hidden" name="sentence" value="{{ bart_prediction }}">
                    <input type="hidden" name="source" value="bart">
                    <button type="submit" class="voice-button">
                        <img src="/static/icons/man_voice_icon.png" alt="Play voice" />
                    </button>
                </form>
            </div>
            <div id="bart-audio-container" class="audio-container {% if not bart_audio_file %}hidden{% endif %}">
                {% if bart_audio_file %}
                <audio controls>
                    <source src="/static/{{ bart_audio_file }}" type="audio/mpeg">
                    Your browser does not support the audio element.
                </audio>
                {% endif %}
            </div>
        </div>
        
        <!-- GPT Refined Section -->
        <div class="rectangle">
            <h3>GPT-4 Refined</h3>
            <p>{{ gpt_refined }}</p>
            <div id="gpt-button-container" {% if gpt_audio_file %}class="hidden"{% endif %}>
                <form action="/speak" method="get" class="voice-form">
                    <input type="hidden" name="sentence" value="{{ gpt_refined }}">
                    <input type="hidden" name="source" value="gpt">
                    <button type="submit" class="voice-button">
                        <img src="/static/icons/man_voice_icon.png" alt="Play voice" />
                    </button>
                </form>
            </div>
            <div id="gpt-audio-container" class="audio-container {% if not gpt_audio_file %}hidden{% endif %}">
                {% if gpt_audio_file %}
                <audio controls>
                    <source src="/static/{{ gpt_audio_file }}" type="audio/mpeg">
                    Your browser does not support the audio element.
                </audio>
                {% endif %}
            </div>
        </div>
        
        <a href="/index">Go back</a>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle form submissions
    document.querySelectorAll('.voice-form').forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const source = this.querySelector('input[name="source"]').value;
            const buttonContainer = document.getElementById(`${source}-button-container`);
            const audioContainer = document.getElementById(`${source}-audio-container`);
            
            // Show loading state
            buttonContainer.classList.add('hidden');
            
            // Submit the form
            fetch(this.action + '?' + new URLSearchParams(new FormData(this)))
                .then(response => response.text())
                .then(html => {
                    document.write(html);
                })
                .catch(error => {
                    console.error('Error:', error);
                    buttonContainer.classList.remove('hidden');
                });
        });
    });
});
</script>
{% endblock %}
